{"ast":null,"code":"import _classCallCheck from\"I:\\\\jobs\\\\react.js\\\\sheet-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"I:\\\\jobs\\\\react.js\\\\sheet-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"I:\\\\jobs\\\\react.js\\\\sheet-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"I:\\\\jobs\\\\react.js\\\\sheet-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"I:\\\\jobs\\\\react.js\\\\sheet-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React,{Component}from'react';import readXlsxFile from'read-excel-file';import{Payback,TranSport}from'../apis/datas';import{Button,Card,Select,Col,Table,message}from'antd';import{withCookies}from'react-cookie';import ExportExcel from'./ExporotExcel';var Option=Select.Option;var columns=[{title:'วันที่',dataIndex:'dates',key:'dates',width:100},{title:'เลขพัสดุ',dataIndex:'number',key:'number',width:150},{title:'ราคาสินค้า\t',dataIndex:'price',key:'price',width:100},{title:'ชื่อลูกค้า',dataIndex:'customer',key:'customer',width:150},{title:'ที่อยู่จัดส่งพัสดุ',dataIndex:'address',key:'address',width:250},{title:'รหัสไปรษณี',dataIndex:'post',key:'post',width:100},{title:'เบอร์ติดต่อ',dataIndex:'phone',key:'phone',width:150}];var CodPayBack=/*#__PURE__*/function(_Component){_inherits(CodPayBack,_Component);function CodPayBack(){var _this;_classCallCheck(this,CodPayBack);_this=_possibleConstructorReturn(this,_getPrototypeOf(CodPayBack).call(this));_this.importExcel=function(){var input=document.getElementById('file');var result=[],error=[];readXlsxFile(input.files[0],{}).then(function(res){res.forEach(function(arr){if(arr[0]===null||arr[1]===null||arr[2]===null||arr[3]===null){//console.log(\"พบข้อผิดพลาดในไฟล์อัพโหลด\")      \nerror.push({\"dates\":arr[0],\"number\":arr[1],\"price\":arr[2],\"customer\":arr[3],\"address\":arr[4],\"post\":arr[5],\"phone\":arr[6]});_this.setState({boxError:error});}else{var arr0=new Date(arr[0]);arr0.setFullYear(arr0.getFullYear()-543);var a=arr0.toLocaleDateString('th-TH',{year:'numeric',month:'2-digit',day:'2-digit'});var arr1=arr[1],arr2=arr[2].toLocaleString('en-US',{minimumFractionDigits:2}),arr3=arr[3],arr4=arr[4],arr5=arr[5],arr6=arr[6];result.push({dates:a.toString(),number:arr1,price:arr2,customer:arr3,address:arr4,post:arr5,phone:arr6});}});var fill=result.filter(function(result){return result.number!==\"เลขพัสดุ\";});console.log(fill);_this.setState({file:fill});});};_this.Upload=function(){var cookies=_this.props.cookies;var user=cookies.get('userNumber'),store=cookies.get('storeNumber'),excel=_this.state.file,transport_comp=_this.state.transportSelect.toString();message.loading('upload...',2).then(function(){if(excel.length>0){new Promise(function(resolve,rejects){var a=Payback(user,transport_comp,excel,store);resolve(a);}).then(function(res){var code=res.code,mess=res.message;console.log(code);if(code==='1'){message.success(mess,2).then(function(){document.getElementById('file').value=null;_this.setState({file:[]});});}else{message.error('error',2);}}).catch(function(err){console.log(err);});}else{message.warning('ไม่พบข้อมูล',2);}});};_this.TranSportSelect=function(value){//console.log(value)\nif(value>0){_this.setState({transportSelect:value,buttonUpload:false});}else{_this.setState({buttonUpload:true});}};_this.state={file:[],tranSportList:[],transportSelect:[],buttonUpload:true,boxError:[]};return _this;}_createClass(CodPayBack,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;new Promise(function(resolve,rejects){resolve(TranSport());}).then(function(res){_this2.setState({tranSportList:res});});}},{key:\"render\",value:function render(){return React.createElement(\"div\",{style:{padding:\"2.7% 0 0 0\"}},React.createElement(\"div\",{style:{// backgroundColor: \"#f7f7f7\",\n// width: \"100%\",\n// height: \"100%\",\n// position: \"absolute\"\n}},React.createElement(\"br\",null),React.createElement(Col,{lg:{span:6,offset:2}},React.createElement(Card,{style:{boxShadow:\"0 3px 6px 0 rgba(0, 0, 0, 0.2)\"}},React.createElement(\"div\",{style:{textAlign:\"center\"}},\"\\u0E2D\\u0E31\\u0E1E\\u0E42\\u0E2B\\u0E25\\u0E14 shoping payback\"),React.createElement(\"br\",null),React.createElement(\"input\",{type:\"file\",id:\"file\",onChange:this.importExcel,style:{width:180}}),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(\"label\",null,React.createElement(\"span\",null,\"\\u0E1A\\u0E23\\u0E34\\u0E29\\u0E31\\u0E17\\u0E02\\u0E19\\u0E2A\\u0E48\\u0E07 : \"),React.createElement(Select,{id:\"transport\",style:{width:200},onChange:this.TranSportSelect},this.state.tranSportList.map(function(data,index){return React.createElement(Option,{key:index,value:data.transport_company_number},data.transport_company_name);}))),React.createElement(\"br\",null),React.createElement(\"br\",null),React.createElement(Button,{block:true,onClick:this.Upload,disabled:this.state.buttonUpload},\"\\u0E2D\\u0E31\\u0E1E\\u0E42\\u0E2B\\u0E25\\u0E14\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\")),React.createElement(\"br\",null),React.createElement(Card,{style:{boxShadow:\"0 3px 6px 0 rgba(0, 0, 0, 0.2)\"}},React.createElement(\"label\",null,React.createElement(\"span\",null,\"\\u0E02\\u0E31\\u0E49\\u0E19\\u0E15\\u0E2D\\u0E19\\u0E01\\u0E32\\u0E23 Upload File Excel\"),React.createElement(ExportExcel,null)))),React.createElement(Col,{lg:{span:13,offset:1}},React.createElement(Table,{style:{boxShadow:\"0 3px 6px 0 rgba(0, 0, 0, 0.2)\"},size:\"small\",columns:columns,title:function title(){return\"ข้อมูลนำเข้า\";},dataSource:this.state.file,scroll:{x:500,y:500}}),React.createElement(\"br\",null),React.createElement(Table,{style:{boxShadow:\"0 3px 6px 0 rgba(0, 0, 0, 0.2)\"},size:\"small\",columns:columns,title:function title(){return\"ข้อมูลผิดพลาด\";},dataSource:this.state.boxError,scroll:{x:500,y:500}}))));}}]);return CodPayBack;}(Component);export default withCookies(CodPayBack);","map":{"version":3,"sources":["I:/jobs/react.js/sheet-app/src/components/CodPayBack.jsx"],"names":["React","Component","readXlsxFile","Payback","TranSport","Button","Card","Select","Col","Table","message","withCookies","ExportExcel","Option","columns","title","dataIndex","key","width","CodPayBack","importExcel","input","document","getElementById","result","error","files","then","res","forEach","arr","push","setState","boxError","arr0","Date","setFullYear","getFullYear","a","toLocaleDateString","year","month","day","arr1","arr2","toLocaleString","minimumFractionDigits","arr3","arr4","arr5","arr6","dates","toString","number","price","customer","address","post","phone","fill","filter","console","log","file","Upload","cookies","props","user","get","store","excel","state","transport_comp","transportSelect","loading","length","Promise","resolve","rejects","code","mess","success","value","catch","err","warning","TranSportSelect","buttonUpload","tranSportList","padding","span","offset","boxShadow","textAlign","map","data","index","transport_company_number","transport_company_name","x","y"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport readXlsxFile from 'read-excel-file'\r\nimport { Payback, TranSport } from '../apis/datas'\r\nimport { Button, Card, Select, Col, Table, message } from 'antd'\r\nimport { withCookies } from 'react-cookie'\r\nimport ExportExcel from './ExporotExcel'\r\n\r\nconst { Option } = Select\r\nconst columns = [{\r\n  title: 'วันที่',\r\n  dataIndex: 'dates',\r\n  key: 'dates',\r\n  width: 100\r\n}, {\r\n  title: 'เลขพัสดุ',\r\n  dataIndex: 'number',\r\n  key: 'number',\r\n  width: 150\r\n}, {\r\n  title: 'ราคาสินค้า\t',\r\n  dataIndex: 'price',\r\n  key: 'price',\r\n  width: 100\r\n}, {\r\n  title: 'ชื่อลูกค้า',\r\n  dataIndex: 'customer',\r\n  key: 'customer',\r\n  width: 150\r\n}, {\r\n  title: 'ที่อยู่จัดส่งพัสดุ',\r\n  dataIndex: 'address',\r\n  key: 'address',\r\n  width: 250\r\n}, {\r\n  title: 'รหัสไปรษณี',\r\n  dataIndex: 'post',\r\n  key: 'post',\r\n  width: 100\r\n}, {\r\n  title: 'เบอร์ติดต่อ',\r\n  dataIndex: 'phone',\r\n  key: 'phone',\r\n  width: 150\r\n}]\r\nclass CodPayBack extends Component {\r\n  constructor() {\r\n    super()\r\n    this.state = {\r\n      file: [],\r\n      tranSportList: [],\r\n      transportSelect: [],\r\n      buttonUpload: true,\r\n      boxError: []\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    new Promise((resolve, rejects) => {\r\n      resolve(TranSport())\r\n    }).then(res => {\r\n      this.setState({\r\n        tranSportList: res\r\n      })\r\n    })\r\n  }\r\n\r\n  importExcel = () => {\r\n    const input = document.getElementById('file')\r\n    let result = [],\r\n    error=[]\r\n    readXlsxFile(input.files[0], {})\r\n      .then(res => {\r\n        res.forEach(arr => {\r\n          if (arr[0] === null || arr[1] === null || arr[2] === null || arr[3] === null) {\r\n            //console.log(\"พบข้อผิดพลาดในไฟล์อัพโหลด\")      \r\n            error.push({\r\n              \"dates\": arr[0],\r\n              \"number\": arr[1],\r\n              \"price\": arr[2],\r\n              \"customer\": arr[3],\r\n              \"address\": arr[4],\r\n              \"post\": arr[5],\r\n              \"phone\": arr[6]\r\n            })\r\n            this.setState({\r\n              boxError: error\r\n            })\r\n\r\n          } else {\r\n            let arr0 = new Date(arr[0])\r\n            arr0.setFullYear(arr0.getFullYear() - 543)\r\n            let a = arr0.toLocaleDateString('th-TH', {\r\n              year: 'numeric',\r\n              month: '2-digit',\r\n              day: '2-digit'\r\n            })\r\n            let arr1 = arr[1],\r\n              arr2 = arr[2].toLocaleString('en-US', { minimumFractionDigits: 2 }),\r\n              arr3 = arr[3],\r\n              arr4 = arr[4],\r\n              arr5 = arr[5],\r\n              arr6 = arr[6]\r\n            result.push({\r\n              dates: a.toString(),\r\n              number: arr1,\r\n              price: arr2,\r\n              customer: arr3,\r\n              address: arr4,\r\n              post: arr5,\r\n              phone: arr6\r\n            })\r\n          }\r\n        })\r\n        var fill = result.filter((result) => {\r\n          return result.number !== \"เลขพัสดุ\"\r\n        })\r\n        console.log(fill)\r\n        this.setState({\r\n          file: fill\r\n        })\r\n      })\r\n  }\r\n\r\n  Upload = () => {\r\n    const { cookies } = this.props\r\n    let user = cookies.get('userNumber'),\r\n      store = cookies.get('storeNumber'),\r\n      excel = this.state.file,\r\n      transport_comp = this.state.transportSelect.toString()\r\n    message.loading('upload...', 2)\r\n      .then(() => {\r\n        if (excel.length > 0) {\r\n          new Promise((resolve, rejects) => {\r\n            var a = Payback(user, transport_comp, excel, store)\r\n            resolve(a)\r\n          }).then(res => {\r\n            let code = res.code,\r\n              mess = res.message\r\n            console.log(code)\r\n            if (code === '1') {\r\n              message.success(mess, 2)\r\n                .then(() => {\r\n                  document.getElementById('file').value = null\r\n                  this.setState({\r\n                    file: []\r\n                  })\r\n                })\r\n            } else {\r\n              message.error('error', 2)\r\n            }\r\n          })\r\n            .catch(err => { console.log(err) })\r\n        } else {\r\n          message.warning('ไม่พบข้อมูล', 2)\r\n        }\r\n      })\r\n  }\r\n\r\n\r\n  TranSportSelect = (value) => {\r\n    //console.log(value)\r\n    if (value > 0) {\r\n      this.setState({\r\n        transportSelect: value,\r\n        buttonUpload: false\r\n      })\r\n    } else {\r\n      this.setState({\r\n        buttonUpload: true\r\n      })\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div style={{ padding: \"2.7% 0 0 0\" }}>\r\n        <div style={{\r\n          // backgroundColor: \"#f7f7f7\",\r\n          // width: \"100%\",\r\n          // height: \"100%\",\r\n          // position: \"absolute\"\r\n        }}>\r\n          <br />\r\n          <Col lg={{ span: 6, offset: 2 }} >\r\n            <Card style={{ boxShadow: \"0 3px 6px 0 rgba(0, 0, 0, 0.2)\" }}>\r\n              <div style={{ textAlign: \"center\" }}>อัพโหลด shoping payback</div>\r\n              <br />\r\n              <input type=\"file\" id=\"file\" onChange={this.importExcel} style={{ width: 180, }} />\r\n              <br />\r\n              <br />\r\n              <label>\r\n                <span>บริษัทขนส่ง : </span>\r\n                <Select\r\n                  id={\"transport\"}\r\n                  style={{ width: 200 }}\r\n                  onChange={this.TranSportSelect}\r\n                >\r\n                  {this.state.tranSportList.map((data, index) => (\r\n                    <Option key={index} value={data.transport_company_number}>{data.transport_company_name}</Option>\r\n                  ))}\r\n                </Select>\r\n              </label>\r\n              <br />\r\n              <br />\r\n              <Button block onClick={this.Upload} disabled={this.state.buttonUpload}>อัพโหลดข้อมูล</Button>\r\n            </Card>\r\n            <br />\r\n            <Card style={{ boxShadow: \"0 3px 6px 0 rgba(0, 0, 0, 0.2)\" }}>\r\n              <label>\r\n                <span>ขั้นตอนการ Upload File Excel</span>\r\n                <ExportExcel />\r\n              </label>\r\n            </Card>\r\n          </Col>\r\n          <Col lg={{ span: 13, offset: 1 }}>\r\n            <Table style={{ boxShadow: \"0 3px 6px 0 rgba(0, 0, 0, 0.2)\" }} size=\"small\" columns={columns} title={()=>(\"ข้อมูลนำเข้า\")} dataSource={this.state.file} scroll={{ x: 500, y: 500 }} />\r\n            <br />\r\n            <Table style={{ boxShadow: \"0 3px 6px 0 rgba(0, 0, 0, 0.2)\" }} size=\"small\" columns={columns} title={()=>(\"ข้อมูลผิดพลาด\")} dataSource={this.state.boxError} scroll={{ x: 500, y: 500 }} />\r\n          </Col>\r\n        </div>\r\n      </div >\r\n    )\r\n  }\r\n}\r\n\r\nexport default withCookies(CodPayBack)\r\n"]},"metadata":{},"sourceType":"module"}